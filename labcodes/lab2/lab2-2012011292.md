## lab2实验报告
### 2012011292 王子寒

注：本实验代码所在gitserver网址为 [github] 

#### 练习1：实现 first-fit 连续物理内存分配算法。
- 请简要说明你的设计实现过程，并且你的first fit算法是否有进一步的改进空间？

    >  我的first-fit算法是最先匹配算法，在分配过程中首先按链表顺序找到一块不小于所需大小的空闲内存块，然后进行分配。而释放时，则释放完毕后需要向后、向前检查链表中相邻的空闲内存块在物理内存中是否相邻，若相邻，则合并。  
    >  其不足之处在于，此算法将所有的空闲页加入到了空闲链表中，如果只加入空闲块，即空闲块中第一块页的地址加入到空闲链表中，其遍历、加入、删除速度能够更快。

#### 练习2：实现寻找虚拟地址对应的页表项。
- 请描述页目录项（Pag Director Entry）和页表（Page Table Entry）中每个组成部分的含义和以及对ucore而言的潜在用处。

    > 页目录项内容 = 页表起始物理地址 | PTE_U | PTE_W | PTE_P  
    > 页表项内容 = (pa & 0x0FFF) | PTE_P | PTE_W  
    > 页表起始物理地址即所指向的页表的物理起始地址，访问对应项的二级页表时需要用到。  
    > pa即物理地址，结合线性地址的偏移量可以访问具体的内存中的数据。  
    > PTE_U：表示用户态的软件可以读取对应地址的物理内存页内容，这可以完成ucore的权限操作。  
    > PTE_W：表示物理内存页内容可写，这可以完成一系列保护机制。  
    > PTE_P：表示物理内存页存在，这可以结合之后的内存页置换算法起作用。

- 如果ucore执行过程中访问内存，出现了页访问异常，请问硬件要做哪些事情？

    > 需要在内核栈中保存相应的异常信息与中断现场，同时将中断号保存到相应的寄存器中，然后操作系统通过查询相应的栈与寄存器来处理异常。

#### 练习3：释放某虚地址所在的页并取消对应二级页表项的映射。
- 数据结构Page的全局变量（其实是一个数组）的每一项与页表中的页目录项和页表项有无对应关系？如果有，其对应关系是什么？

    > 有对应关系，页表项中存储的物理地址，其指向的便是一个Page变量。（但反之不一定成立）

- 如果希望虚拟地址与物理地址相等，则需要如何修改lab2，完成此事？

    > 只需要通过bootloader将ucore读取到内存0xC0100000的位置即可。

##### 实验感想：
> 本次实验在代码的难度上有所提升，特别是first-fit，其自由度非常大，因为也带来了相当大的难度。
> 通过这次实验我感觉到了，尽管对于操作系统中某些实现机制有了详细的了解，到了代码层也依旧无法很好地运用。
> 而其关键在于对于代码架构以及一些数据结构、变量和常量的理解不够透彻，还需要花更多的时间来好好读代码。

[github]:https://github.com/thu011292/ucore_lab.git
